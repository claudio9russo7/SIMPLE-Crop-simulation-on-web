<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>A SIMPLE approach to crop modelling</title>

  <!-- Pyodide: Python in WebAssembly -->
  <script src="https://cdn.jsdelivr.net/pyodide/v0.29.2/full/pyodide.js"></script>

  <!-- Chart.js per i grafici -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  

  <link rel="stylesheet" href="styles.css" />
  <script src="app.js" defer></script>
</head>

<body>
  <div id="panel">
    <h1> A SIMPLE approach to crop modelling</h1>
    <div class="sub">
      Questa pagina utilizza SIMPLE per simulare la crescita delle colture direttamente nel browser.
      (SIMPLE: Zhao et al., 2019 DOI: https://doi.org/10.1016/j.eja.2019.01.009)
    </div>

    <div class="box">
      <div class="row" style="gap:12px; align-items:flex-start">
        <div style="flex:1">
          <label>Status</label>
          <div id="status" style="margin-top:6px;font-size:12px; color:var(--muted)">Caricamento…</div>
        </div>
        <button id="btnInit">Carica le librerie necessarie</button>
      </div>
    </div>

    <div class="box">
  <div class="row" style="justify-content:space-between; align-items:flex-start">
    <div style="flex:1">
      <label>Meteo (seleziona)</label>
      <div class="tiny" style="margin-top:6px">
        Scegli uno dei CSV disponibili (niente upload).
      </div>
    </div>
  </div>
  <div class="row" style="margin-top:10px">
  <label>Semina (data)</label>
  <input id="sowDate" type="date" disabled>
</div>

<div class="row" style="margin-top:10px">
  <label>Semina (riga)</label>
  <input id="sowIdx" type="number" min="1" step="1" value="1" disabled>
</div>

<div id="sowInfo" class="tiny" style="margin-top:8px">Carica un meteo per scegliere la semina.</div>

  <select id="meteoSelect" style="margin-top:10px; width:100%; padding:8px 10px; border-radius:12px; border:1px solid var(--border); background:rgba(0,0,0,0.25); color:var(--text)"></select>

  <div class="btnrow" style="margin-top:10px">
    <button id="btnLoadMeteo">Usa questo meteo</button>
    <button id="btnClearCsv" disabled>Cancella il meteo selezionato</button>
  </div>

  <div id="csvInfo" class="tiny" style="margin-top:8px">Nessun meteo selezionato: userò gli slider.</div>
</div>

<div class="box">
  <div class="row"><label>Scenario (moltiplicatori)</label></div>
  <div class="tiny" style="margin-top:6px">
    Applico questi fattori al meteo caricato dal CSV (dopo la semina).
  </div>

  <div class="row" style="margin-top:10px"><label>Tmax ×</label><b id="vTmaxMult">1.00</b></div>
  <input id="tmaxMult" type="range" min="1" max="2.5" step="0.05" value="1">

  <div class="row" style="margin-top:10px"><label>Tmin ×</label><b id="vTminMult">1.00</b></div>
  <input id="tminMult" type="range" min="1" max="2.5" step="0.05" value="1">

  <div class="row" style="margin-top:10px"><label>CO₂ (ppm, override)</label><b id="vC02ppm">400</b></div>
  <input id="c02ppm" type="range" min="350" max="1000" step="10" value="400">
</div>

    <div class="box">
      <div class="btnrow">
        <button id="btnRun" disabled>Run</button>
        <button id="btnReset" disabled>Reset</button>
        <button id="btnClearRuns" disabled>Pulisci confronti</button>
      </div>
      <div class="tiny" style="margin-top:8px">
        Suggerimento: per l'effetto “process-based”, prova prima senza acqua (<b>Precip=0</b>), poi aumenta ET0 o Irrig e guarda <b>fw</b> e <b>fsol</b>.
      </div>
    </div>

<details class="box">
  <summary>Parametri modello — specie & cultivar</summary>

  <div class="row" style="margin-top:10px">
    <label>Specie</label>
    <select id="speciesSelect" style="width:200px; padding:8px 10px; border-radius:12px; border:1px solid var(--border); background:rgba(0,0,0,0.25); color:var(--text)"></select>
    <div class="row" style="margin-top:8px; justify-content:flex-start; gap:10px">
        <input id="unlockSpecies" type="checkbox">
        <label for="unlockSpecies" style="cursor:pointer">Sblocca parametri specie</label>
    </div>
 </div>

  <div class="row" style="margin-top:10px">
    <label>Cultivar</label>
    <select id="cultivarSelect" style="width:200px; padding:8px 10px; border-radius:12px; border:1px solid var(--border); background:rgba(0,0,0,0.25); color:var(--text)"></select>
  </div>

  <div class="tiny" id="cropInfo" style="margin-top:6px">—</div>

  <div class="tiny" style="margin-top:10px">Specie (di solito stabile):</div>
  <div id="speciesGrid" class="kv" style="margin-top:8px"></div>

  <div class="tiny" style="margin-top:10px">Cultivar (puoi crearne di nuove):</div>
  <div id="cultivarGrid" class="kv" style="margin-top:8px"></div>

  <div class="row" style="margin-top:10px; gap:10px">
  </div>

  <div class="btnrow" style="margin-top:10px">
    <button id="btnSaveCultivar" type="button">Salva cultivar (nel browser)</button>
    <button id="btnExportCultivar" type="button">Esporta cultivar JSON</button>
    <div class="row" style="margin-top:10px; gap:10px">
        <label>Nome nuova cultivar</label>
        <input id="newCultivarName" type="text" placeholder="es. Grano — precoce" 
            style="flex:1; padding:8px 10px; border-radius:12px; border:1px solid var(--border); background:rgba(0,0,0,0.25); color:var(--text)">
</div>
  </div>

  <div class="tiny" style="margin-top:8px">
    Nota: “Salva cultivar” usa localStorage (resta sul tuo PC/browser). Per condividerla usa “Esporta”.
  </div>
</details>
  </div>
<div id="main">
    <div id="topCharts" class="grid2">
  <div class="statcard">
    <h2>Biomassa (t/ha)</h2>
    <div id="bioWrap" style="height:260px"><canvas id="chartBio"></canvas></div>
  </div>

  <div class="statcard">
    <h2>Resa (t/ha)</h2>
    <div class="tiny">Barre: resa calcolata sulla biomassa finale (×HI).</div>
    <div style="margin-top:10px; height:260px;">
      <canvas id="yieldChart"></canvas>
    </div>
  </div>
</div>

<div class="statcard" id="stressCard" style="margin-top:14px">
  <h2>Stress</h2>
  <div class="tiny">fw = stress idrico, fh = stress termico</div>
  <div id="stressWrap" style="margin-top:10px; height:260px">
    <canvas id="chartStress"></canvas>
  </div>
</div>

    <div class="statcard">
        <h2>Meteo (T & ET0)</h2>
        <div class="tiny">Serie del periodo simulato (dalla semina).</div>
        <div id="meteoChartWrap" style="margin-top:10px">
        <canvas id="meteoChart"></canvas>
        </div>
  <div class="statcard">
  <h2>Debug / note</h2>
  <div class="tiny" id="log">—</div>
  </div>
    <div class="kv" style="margin-top:10px">
      <span>Data</span><b id="kDate">—</b>
      <span>Tmean</span><b id="kTmean">—</b>
      <span>Tmax</span><b id="kTmax">—</b>
      <span>ET0</span><b id="kEt0">—</b>
    </div>
    </div>
    </div>
</div>

</body>
</html>
